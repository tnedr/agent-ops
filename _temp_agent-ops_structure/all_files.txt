# === ALL FILES SUMMARY ===
Total files: 11
Total size: 19,818 (text chars + binary bytes)
~Tokens(/÷4): 4,954

# === FILES BY EXTENSION ===
[no-ext]: 2 files, 1,433 chars
.md: 2 files, 5,714 chars
.py: 1 files, 10,291 chars
.sh: 1 files, 270 chars
.toml: 2 files, 558 chars
.yml: 3 files, 1,552 chars

# === LARGEST 5 FILES ===
1. actions\pr-bot\pr_bot.py (.py) - 10,291 chars
2. USAGE.md (.md) - 3,324 chars
3. README.md (.md) - 2,390 chars
4. actions\pr-bot\Dockerfile ([no-ext]) - 1,172 chars
5. .github\workflows\pull_request.yml (.yml) - 573 chars

# === FILE: .github\workflows\pull_request.yml ===
# Path: .github\workflows\pull_request.yml
# Type: yml
# Size: 580.0B
# Modified: 2025-11-04T13:36:47.203918

name: PR Pipeline (only bot demo)

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]

jobs:
  merge-gate:
    runs-on: ubuntu-latest
    # nincsenek needs -> közvetlenül fut
    steps:
      - uses: actions/checkout@v4

      - name: Auto-merge with PR-bot
        uses: ./actions/pr-bot          # lokális path, nem kell publikus tag
        with:
          ci: "false"                   # ha átírod "true"-ra, zöld check-et vár
          force: "false"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}



# === FILE: .github\workflows\test-pr-bot.yml ===
# Path: .github\workflows\test-pr-bot.yml
# Type: yml
# Size: 518.0B
# Modified: 2025-11-04T14:50:34.449424

name: Test PR Bot (Self-Test)

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]

jobs:
  test-merge:
    runs-on: ubuntu-latest
    # This job tests the PR bot by using it from the same repo
    steps:
      - uses: actions/checkout@v4

      - name: Test PR-bot (local)
        uses: ./actions/pr-bot
        with:
          ci: "false"    # Don't wait for CI in test mode
          force: "false"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}



# === FILE: .gitignore ===
# Path: .gitignore
# Type: [no-ext]
# Size: 261.0B
# Modified: 2025-11-04T13:42:11.135770

# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
.venv/
venv/
ENV/
env/
*.egg-info/
dist/
build/

# IDE
.vscode/
.idea/
*.swp
*.swo
*~

# OS
.DS_Store
Thumbs.db

# UV cache (optional - usually shared globally)
# E:\uv-cache/



# === FILE: actions\pr-bot\action.yml ===
# Path: actions\pr-bot\action.yml
# Type: yml
# Size: 471.0B
# Modified: 2025-11-04T13:39:24.391117

name: "PR Bot – auto-merge"
description: "Squash-merge PR, opcionálisan csak zöld CI után"

inputs:
  ci:
    description: "Várjon-e zöld check-ekre (true/false)"
    required: false
    default: "false"
  force:
    description: "Admin override – piros check esetén is merge"
    required: false
    default: "false"

runs:
  using: "docker"
  image: "Dockerfile"
  env:
    INPUT_CI: ${{ inputs.ci }}
    INPUT_FORCE: ${{ inputs.force }}



# === FILE: actions\pr-bot\Dockerfile ===
# Path: actions\pr-bot\Dockerfile
# Type: [no-ext]
# Size: 1.1KB
# Modified: 2025-11-04T13:40:24.515519

FROM python:3.11-slim

WORKDIR /app

# Install GitHub CLI and UV
RUN apt-get update && apt-get install -y \
    curl \
    && curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg \
    && chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg \
    && echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | tee /etc/apt/sources.list.d/github-cli.list > /dev/null \
    && apt-get update \
    && apt-get install -y gh \
    && curl -LsSf https://astral.sh/uv/install.sh | sh \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Add UV to PATH
ENV PATH="/root/.cargo/bin:${PATH}"

COPY pr_bot.py entrypoint.sh pyproject.toml .

# Make entrypoint executable
RUN chmod +x entrypoint.sh

# Install dependencies using UV (follows UV Cache Guidelines)
# No external dependencies needed - script uses only standard library
# But we use uv pip sync to ensure proper dependency management
RUN uv pip install --system -e .

ENTRYPOINT ["/app/entrypoint.sh"]



# === FILE: actions\pr-bot\pyproject.toml ===
# Path: actions\pr-bot\pyproject.toml
# Type: toml
# Size: 294.0B
# Modified: 2025-11-04T13:40:24.511520

[project]
name = "pr-bot"
version = "2.3.0"
description = "One-shot GitHub PR automator with CI polling"
requires-python = ">=3.11"

# No external dependencies - uses only Python standard library
dependencies = []

[tool.uv]
# This is a standalone action, no workspace needed here



# === FILE: pyproject.toml ===
# Path: pyproject.toml
# Type: toml
# Size: 264.0B
# Modified: 2025-11-04T13:40:24.511520

[project]
name = "agent-ops"
version = "0.1.0"
description = "Modular PR-bot and Agent/Doc-Ops GitHub Actions"
readme = "README.md"
requires-python = ">=3.11"

[project.optional-dependencies]
dev = []

[tool.uv]
workspace = true

[tool.uv.sources]



# === FILE: README.md ===
# Path: README.md
# Type: md
# Size: 2.4KB
# Modified: 2025-11-04T14:51:15.538346

# agent-ops

Modular PR-bot and Agent/Doc-Ops GitHub Actions repository.

## Overview


This repository contains reusable GitHub Actions for automating PR workflows and agent operations.

## Actions

### PR Bot (`actions/pr-bot`)

One-shot GitHub PR automator with optional CI polling.

**Features:**
- Auto-merge PRs with squash merge
- Optional CI check polling (wait for green checks)
- Admin override flag (`--force`) to merge even with failed checks
- Automatic branch deletion after merge
- Works in both standalone mode and GitHub Actions context

**Usage:**

**From another repository:**

```yaml
name: Auto-merge PR

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]

jobs:
  merge:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Auto-merge with PR-bot
        uses: tnedr/agent-ops/actions/pr-bot@main
        with:
          ci: "false"    # Wait for green CI checks (true/false)
          force: "false" # Admin override - merge even with red checks
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

**From the same repository (local path):**

```yaml
- name: Auto-merge with PR-bot
  uses: ./actions/pr-bot
  with:
    ci: "false"
    force: "false"
  env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

**Configuration:**

- `ci`: Set to `"true"` to wait for CI checks to pass before merging (default: `"false"`)
- `force`: Set to `"true"` to merge even if checks fail (requires admin permissions, default: `"false"`)

**Versioning:**

You can use specific versions:
- `@main` - Latest from main branch (may be unstable)
- `@v1` - Specific version tag (recommended for production)
- `@v1.0.0` - Exact version tag

To create a version tag:
```bash
git tag v1
git push origin v1
```

## Development

This project follows UV Cache Workflow Guidelines:

- Uses `uv` for package management
- Minimal `.venv`, maximum cache usage
- Global cache location: `E:\uv-cache` (Windows)

### Setup

```bash
# Install dependencies
uv pip install -e .
```

### Structure

```
agent-ops/
├── actions/
│   └── pr-bot/          # PR automation action
├── .github/
│   └── workflows/       # GitHub workflows
└── pyproject.toml       # Root workspace configuration
```

## License

MIT



# === FILE: USAGE.md ===
# Path: USAGE.md
# Type: md
# Size: 3.3KB
# Modified: 2025-11-04T14:51:15.538346

# Using agent-ops Actions in Other Repositories

## Quick Start

Add this workflow to `.github/workflows/auto-merge.yml` in your repository:

```yaml
name: Auto-merge PR

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]

jobs:
  merge:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Auto-merge with PR-bot
        uses: tnedr/agent-ops/actions/pr-bot@main
        with:
          ci: "false"    # Set to "true" to wait for CI checks
          force: "false" # Set to "true" to merge even with failed checks
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

## Configuration Options

### Wait for CI Checks

If you want the bot to wait for all CI checks to pass before merging:

```yaml
with:
  ci: "true"  # Wait for green checks
```

### Force Merge (Admin Override)

If you want to merge even when checks fail (requires admin permissions):

```yaml
with:
  force: "true"  # Merge even with failed checks
```

## Versioning

### Using Latest (Main Branch)

```yaml
uses: tnedr/agent-ops/actions/pr-bot@main
```

⚠️ **Warning**: This uses the latest code, which may be unstable.

### Using Version Tags (Recommended)

```yaml
uses: tnedr/agent-ops/actions/pr-bot@v1
```

First, create a version tag in the agent-ops repository:

```bash
git tag v1
git push origin v1
```

Then use `@v1` in your workflow for stability.

## Testing

### Test in Your Repository

1. Create a test branch:
   ```bash
   git checkout -b test/pr-bot
   ```

2. Make a small change:
   ```bash
   echo "Test" >> test.txt
   git add test.txt
   git commit -m "test: PR bot"
   git push -u origin test/pr-bot
   ```

3. Create a PR on GitHub

4. The bot should automatically merge it after 5 seconds (if `ci: "false"`)

### Test in agent-ops Repository

The `agent-ops` repository has its own test workflow (`.github/workflows/test-pr-bot.yml`) that tests the bot locally.

## How It Works

1. **PR Created**: When a PR is opened/updated
2. **Workflow Triggered**: The GitHub Action workflow starts
3. **Bot Runs**: The PR bot checks the PR status
4. **Wait Period**: Default 5 seconds (configurable via `--wait`)
5. **CI Check** (optional): If `ci: "true"`, waits for all checks to pass
6. **Merge**: Squash merges the PR
7. **Cleanup**: Deletes the source branch

## Permissions

The action requires the `GITHUB_TOKEN` secret, which is automatically available in GitHub Actions. Make sure your repository has the following permissions:

- **Contents**: Write (to merge PRs)
- **Pull requests**: Write (to merge and delete branches)

These are usually set automatically, but you can check in:
- Repository Settings → Actions → General → Workflow permissions

## Troubleshooting

### Bot Not Merging

1. Check workflow permissions
2. Verify `GITHUB_TOKEN` is set
3. Check workflow logs for errors
4. Ensure PR is not in draft mode

### CI Checks Not Passing

- If `ci: "true"`, the bot waits for all checks
- If checks fail, set `force: "true"` to override (requires admin permissions)

### Permission Errors

- Ensure the `GITHUB_TOKEN` has write permissions
- Check repository settings for workflow permissions


